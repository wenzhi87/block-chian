<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>元宇宙專案 - 區塊鏈學習平台</title>
  <style>
    body { margin: 0; background: #000; overflow: hidden; font-family: Arial; }
    main { width: 100%; height: 100vh; position: relative; }
    #ui { position: absolute; top: 10px; left: 10px; z-index: 10; }
    #ui button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    #fileInput { display: none; }
    canvas { display: block; }
  </style>
</head>
<body>
  <main id="scene-container">
    <div id="ui">
      <button id="btnCube">新增立方體</button>
      <button id="btnSphere">新增球體</button>
      <button id="btnModel">載入模型</button>
      <input type="file" id="fileInput" accept=".gltf,.glb" />
      <button id="btnReset">重設視角</button>
    </div>
  </main>

  <script type="module">
    import * as THREE from './three.module.js';
    import { OrbitControls } from './OrbitControls.js';
    import { GLTFLoader } from './GLTFLoader.js';

    const container = document.getElementById("scene-container");

    // === 初始化場景 ===
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const camera = new THREE.PerspectiveCamera(
      75,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    camera.position.set(0, 2, 5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    // 光源
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7.5);
    scene.add(light);

    // 地板
    const plane = new THREE.Mesh(
      new THREE.PlaneGeometry(50, 50),
      new THREE.MeshStandardMaterial({ color: 0x222222 })
    );
    plane.rotation.x = -Math.PI / 2;
    scene.add(plane);

    // 相機控制
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // === 新增立方體 ===
    function addCube() {
      const cube = new THREE.Mesh(
        new THREE.BoxGeometry(1, 1, 1),
        new THREE.MeshStandardMaterial({ color: Math.random() * 0xffffff })
      );
      cube.position.set((Math.random() - 0.5) * 10, 0.5, (Math.random() - 0.5) * 10);
      scene.add(cube);
    }

    // === 新增球體 ===
    function addSphere() {
      const sphere = new THREE.Mesh(
        new THREE.SphereGeometry(0.5, 32, 32),
        new THREE.MeshStandardMaterial({ color: Math.random() * 0xffffff })
      );
      sphere.position.set((Math.random() - 0.5) * 10, 0.5, (Math.random() - 0.5) * 10);
      scene.add(sphere);
    }

    // === 載入模型 ===
    const loader = new GLTFLoader();
    document.getElementById("btnModel").addEventListener("click", () => {
      document.getElementById("fileInput").click();
    });

    document.getElementById("fileInput").addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const url = URL.createObjectURL(file);
      loader.load(
        url,
        (gltf) => {
          const model = gltf.scene;
          model.position.set(0, 0, 0);
          model.scale.set(1, 1, 1);
          scene.add(model);
        },
        undefined,
        (err) => console.error("❌ 模型載入失敗", err)
      );
    });

    // === 重設視角 ===
    function resetCamera() {
      camera.position.set(0, 2, 5);
      controls.target.set(0, 0, 0);
      controls.update();
    }

    document.getElementById("btnCube").addEventListener("click", addCube);
    document.getElementById("btnSphere").addEventListener("click", addSphere);
    document.getElementById("btnReset").addEventListener("click", resetCamera);

    // === 鍵盤移動 ===
    const keys = {};
    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
      if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key))
        e.preventDefault();
    });
    document.addEventListener("keyup", (e) => (keys[e.key] = false));

    // === 畫面更新 ===
    function animate() {
      requestAnimationFrame(animate);
      const speed = 0.1;
      if (keys["ArrowUp"]) camera.position.z -= speed;
      if (keys["ArrowDown"]) camera.position.z += speed;
      if (keys["ArrowLeft"]) camera.position.x -= speed;
      if (keys["ArrowRight"]) camera.position.x += speed;

      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    // 視窗大小變化
    window.addEventListener("resize", () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });
  </script>
</body>
</html>
